<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANTA PRO | AI Trading Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- TradingView Lightweight Charts - Fixed Version -->
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&family=Assistant:wght@400;700&display=swap');
        
        body {
            background-color: #05070a;
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        .hebrew { font-family: 'Assistant', sans-serif; direction: rtl; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 260px 1fr 320px;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            gap: 12px;
            padding: 12px;
        }

        .card {
            background: #0c111d;
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #chart-container {
            width: 100%;
            height: 100%;
            min-height: 400px;
            background: #0c111d;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [activeTicker, setActiveTicker] = useState('NVDA');
            const chartContainerRef = useRef(null);
            const chartInstance = useRef(null);
            const seriesRef = useRef(null);

            // יצירת נתוני דמה לנרות (OHLC)
            const getMockData = () => {
                const data = [];
                let p = 150 + Math.random() * 50;
                let date = new Date(2024, 0, 1);
                for (let i = 0; i < 150; i++) {
                    const open = p;
                    const high = open + Math.random() * 5;
                    const low = open - Math.random() * 5;
                    const close = low + Math.random() * (high - low);
                    data.push({
                        time: date.toISOString().split('T')[0],
                        open: parseFloat(open.toFixed(2)),
                        high: parseFloat(high.toFixed(2)),
                        low: parseFloat(low.toFixed(2)),
                        close: parseFloat(close.toFixed(2))
                    });
                    p = close;
                    date.setDate(date.getDate() + 1);
                }
                return data;
            };

            useEffect(() => {
                if (!chartContainerRef.current) return;

                const timer = setTimeout(() => {
                    // וודאות שהספרייה נטענה כראוי
                    if (typeof LightweightCharts === 'undefined') {
                        console.error('LightweightCharts not loaded');
                        return;
                    }

                    const chart = LightweightCharts.createChart(chartContainerRef.current, {
                        width: chartContainerRef.current.clientWidth,
                        height: chartContainerRef.current.clientHeight || 500,
                        layout: {
                            background: { color: '#0c111d' },
                            textColor: '#94a3b8',
                        },
                        grid: {
                            vertLines: { color: '#1e293b' },
                            horzLines: { color: '#1e293b' },
                        },
                        timeScale: { borderColor: '#334155' },
                        rightPriceScale: { borderColor: '#334155' },
                    });

                    // שימוש בשיטה המומלצת ליצירת סדרת נרות
                    const candleSeries = chart.addCandlestickSeries({
                        upColor: '#10b981',
                        downColor: '#f43f5e',
                        borderVisible: false,
                        wickUpColor: '#10b981',
                        wickDownColor: '#f43f5e',
                    });

                    candleSeries.setData(getMockData());
                    chart.timeScale().fitContent();

                    chartInstance.current = chart;
                    seriesRef.current = candleSeries;

                    const handleResize = () => {
                        if (chartContainerRef.current && chartInstance.current) {
                            chartInstance.current.applyOptions({ 
                                width: chartContainerRef.current.clientWidth,
                                height: chartContainerRef.current.clientHeight 
                            });
                        }
                    };

                    window.addEventListener('resize', handleResize);
                }, 200);

                return () => {
                    clearTimeout(timer);
                    if (chartInstance.current) {
                        chartInstance.current.remove();
                        chartInstance.current = null;
                    }
                };
            }, []);

            // עדכון נתונים בהחלפת מניה
            useEffect(() => {
                if (seriesRef.current) {
                    seriesRef.current.setData(getMockData());
                }
            }, [activeTicker]);

            return (
                <div className="dashboard-grid">
                    <header className="col-span-3 card flex-row items-center justify-between px-6 bg-[#080c14]">
                        <div className="flex items-center gap-4">
                            <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center font-bold italic">Q</div>
                            <span className="font-black tracking-tighter text-xl">QUANTA PRO</span>
                        </div>
                        <div className="hebrew text-emerald-500 font-bold text-sm">מחובר לבורסה בזמן אמת</div>
                    </header>

                    <aside className="card p-3 gap-2">
                        <div className="hebrew text-[10px] text-slate-500 font-bold mb-2 mr-2 uppercase tracking-widest">רשימת מעקב</div>
                        {['NVDA', 'AAPL', 'TSLA', 'MSFT', 'BTC', 'ETH'].map(t => (
                            <div key={t} 
                                 onClick={() => setActiveTicker(t)}
                                 className={`p-3 rounded-xl cursor-pointer transition-all ${activeTicker === t ? 'bg-blue-600/20 border border-blue-500/50 text-white' : 'hover:bg-white/5 border border-transparent text-slate-400'}`}>
                                <div className="mono font-bold">{t}</div>
                            </div>
                        ))}
                    </aside>

                    <main className="flex flex-col gap-3">
                        <div className="card p-6 flex flex-row justify-between items-center bg-gradient-to-r from-slate-900 to-black shadow-2xl">
                            <h2 className="text-4xl font-black mono tracking-tighter">{activeTicker}</h2>
                            <div className="text-right">
                                <div className="hebrew text-[10px] text-slate-500 font-bold uppercase">מחיר נוכחי</div>
                                <div className="text-3xl font-bold mono text-emerald-400">$142.50</div>
                            </div>
                        </div>

                        <div className="card flex-1 p-0 relative min-h-0 border-blue-500/10">
                            <div className="absolute top-4 left-6 z-10 hebrew text-[10px] font-bold bg-black/60 backdrop-blur-sm p-2 rounded border border-white/10 text-slate-300">
                                גרף נרות חי • השתמש בגלגלת לזום
                            </div>
                            <div ref={chartContainerRef} id="chart-container"></div>
                        </div>
                    </main>

                    <aside className="card p-5">
                        <h3 className="hebrew font-bold mb-4 border-b border-white/5 pb-2 uppercase text-xs tracking-widest text-slate-400">ביצוע עסקה</h3>
                        <div className="space-y-4 mt-4">
                            <button className="w-full bg-emerald-600 hover:bg-emerald-500 transition-colors py-4 rounded-xl font-bold uppercase text-xs shadow-lg shadow-emerald-900/20">Buy Market</button>
                            <button className="w-full bg-rose-600 hover:bg-rose-500 transition-colors py-4 rounded-xl font-bold uppercase text-xs shadow-lg shadow-rose-900/20">Sell Market</button>
                        </div>
                        
                        <div className="mt-10">
                            <h4 className="hebrew text-[10px] text-slate-500 font-bold mb-3 uppercase tracking-widest">AI Insights</h4>
                            <div className="bg-blue-500/5 p-4 rounded-xl border-r-4 border-blue-500 text-right">
                                <p className="hebrew text-xs leading-relaxed text-slate-300">ניתוח אלגוריתמי מזהה מגמת עלייה בטווח הקצר. מומלץ לעקוב אחרי רמת התנגדות ב-145$.</p>
                            </div>
                        </div>
                    </aside>

                    <footer className="col-span-3 flex items-center justify-between px-4 text-[9px] text-slate-600 font-bold uppercase tracking-widest border-t border-white/5">
                        <span>Terminal Engine v4.0</span>
                        <span className="hebrew opacity-50 text-[10px]">מערכת מסחר קוואנטה • 2024</span>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
