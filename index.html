<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANTA PRO | AI Trading Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&family=Assistant:wght@400;700&display=swap');
        
        body {
            background-color: #05070a;
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        .hebrew { font-family: 'Assistant', sans-serif; direction: rtl; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 260px 1fr 320px;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            gap: 12px;
            padding: 12px;
        }

        .card {
            background: #0c111d;
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #chart-container {
            width: 100%;
            height: 100%;
            min-height: 400px;
        }

        .chart-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 20;
            display: flex;
            gap: 8px;
        }

        .control-btn {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            backdrop-filter: blur(4px);
        }

        .control-btn:hover { background: rgba(59, 130, 246, 0.5); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [activeTicker, setActiveTicker] = useState('NVDA');
            const chartContainerRef = useRef(null);
            const chartInstance = useRef(null);
            const seriesRef = useRef(null);

            // ייצור היסטוריה ארוכה (500 ימים) וסימני קנייה/מכירה
            const getExtendedHistory = () => {
                const data = [];
                const markers = [];
                let p = 100 + Math.random() * 100;
                let date = new Date();
                date.setDate(date.getDate() - 500);

                for (let i = 0; i < 500; i++) {
                    const open = p;
                    const high = open + Math.random() * 10;
                    const low = open - Math.random() * 10;
                    const close = low + Math.random() * (high - low);
                    const timeStr = date.toISOString().split('T')[0];
                    
                    data.push({
                        time: timeStr,
                        open: parseFloat(open.toFixed(2)),
                        high: parseFloat(high.toFixed(2)),
                        low: parseFloat(low.toFixed(2)),
                        close: parseFloat(close.toFixed(2))
                    });

                    // הוספת המלצות AI באופן אקראי על הגרף
                    if (i > 450 && Math.random() > 0.95) {
                        const type = Math.random() > 0.5 ? 'buy' : 'sell';
                        markers.push({
                            time: timeStr,
                            position: type === 'buy' ? 'belowBar' : 'aboveBar',
                            color: type === 'buy' ? '#10b981' : '#f43f5e',
                            shape: type === 'buy' ? 'arrowUp' : 'arrowDown',
                            text: type === 'buy' ? 'AI BUY' : 'AI SELL',
                        });
                    }

                    p = close;
                    date.setDate(date.getDate() + 1);
                }
                return { data, markers };
            };

            useEffect(() => {
                if (!chartContainerRef.current) return;

                const timer = setTimeout(() => {
                    if (typeof LightweightCharts === 'undefined') return;

                    const chart = LightweightCharts.createChart(chartContainerRef.current, {
                        layout: {
                            background: { color: '#0c111d' },
                            textColor: '#94a3b8',
                        },
                        grid: {
                            vertLines: { color: 'rgba(255, 255, 255, 0.05)' },
                            horzLines: { color: 'rgba(255, 255, 255, 0.05)' },
                        },
                        timeScale: {
                            borderColor: '#334155',
                            timeVisible: true,
                            secondsVisible: false,
                            shiftVisibleRangeOnNewBar: true,
                            rightOffset: 12, // מרווח מהצד ליצירת "עתיד"
                            barSpacing: 6, // זום התחלתי נוח
                        },
                        rightPriceScale: {
                            borderColor: '#334155',
                            autoScale: true,
                        },
                        handleScale: {
                            mouseWheel: true,
                            pinch: true,
                        },
                        handleScroll: {
                            mouseWheel: true,
                            pressedMouseMove: true,
                        }
                    });

                    const candleSeries = chart.addCandlestickSeries({
                        upColor: '#10b981',
                        downColor: '#f43f5e',
                        borderVisible: false,
                        wickUpColor: '#10b981',
                        wickDownColor: '#f43f5e',
                    });

                    const { data, markers } = getExtendedHistory();
                    candleSeries.setData(data);
                    candleSeries.setMarkers(markers);
                    
                    // התמקדות בנרות האחרונים (זום פנימה בסיום)
                    chart.timeScale().setVisibleRange({
                        from: data[data.length - 60].time,
                        to: data[data.length - 1].time,
                    });

                    chartInstance.current = chart;
                    seriesRef.current = candleSeries;

                    const handleResize = () => {
                        chart.applyOptions({ 
                            width: chartContainerRef.current.clientWidth,
                            height: chartContainerRef.current.clientHeight 
                        });
                    };
                    window.addEventListener('resize', handleResize);
                }, 200);

                return () => {
                    clearTimeout(timer);
                    if (chartInstance.current) chartInstance.current.remove();
                };
            }, []);

            useEffect(() => {
                if (seriesRef.current) {
                    const { data, markers } = getExtendedHistory();
                    seriesRef.current.setData(data);
                    seriesRef.current.setMarkers(markers);
                }
            }, [activeTicker]);

            const handleZoom = (direction) => {
                if (!chartInstance.current) return;
                const ts = chartInstance.current.timeScale();
                if (direction === 'in') ts.zoomIn(1);
                else if (direction === 'out') ts.zoomOut(1);
                else ts.fitContent();
            };

            return (
                <div className="dashboard-grid">
                    <header className="col-span-3 card flex-row items-center justify-between px-6 bg-[#080c14]">
                        <div className="flex items-center gap-4">
                            <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center font-bold italic">Q</div>
                            <span className="font-black tracking-tighter text-xl">QUANTA PRO</span>
                        </div>
                        <div className="hebrew text-emerald-500 font-bold text-sm">ניתוח AI פעיל • היסטוריה מורחבת</div>
                    </header>

                    <aside className="card p-3 gap-2">
                        <div className="hebrew text-[10px] text-slate-500 font-bold mb-2 mr-2 uppercase tracking-widest">נכסים למעקב</div>
                        {['NVDA', 'AAPL', 'TSLA', 'MSFT', 'BTC', 'ETH'].map(t => (
                            <div key={t} 
                                 onClick={() => setActiveTicker(t)}
                                 className={`p-3 rounded-xl cursor-pointer transition-all ${activeTicker === t ? 'bg-blue-600/20 border border-blue-500/50 text-white' : 'hover:bg-white/5 border border-transparent text-slate-400'}`}>
                                <div className="mono font-bold">{t}</div>
                            </div>
                        ))}
                    </aside>

                    <main className="flex flex-col gap-3">
                        <div className="card p-6 flex flex-row justify-between items-center bg-gradient-to-r from-slate-900 to-black shadow-2xl">
                            <h2 className="text-4xl font-black mono tracking-tighter">{activeTicker}</h2>
                            <div className="text-right">
                                <div className="hebrew text-[10px] text-slate-500 font-bold">ביצועים אחרונים</div>
                                <div className="text-3xl font-bold mono text-emerald-400">+$24.15</div>
                            </div>
                        </div>

                        <div className="card flex-1 p-0 relative min-h-0">
                            <div className="absolute top-4 left-6 z-10 flex flex-col gap-2">
                                <div className="hebrew text-[10px] font-bold bg-blue-600 text-white p-2 rounded shadow-lg">
                                    המלצות קנייה/מכירה מוצגות ישירות על הנרות
                                </div>
                                <div className="hebrew text-[9px] bg-black/60 backdrop-blur-sm p-2 rounded border border-white/10 text-slate-400">
                                    500 ימי היסטוריה • גלול אחורה לצפייה
                                </div>
                            </div>

                            <div className="chart-controls">
                                <button onClick={() => handleZoom('in')} className="control-btn">Zoom +</button>
                                <button onClick={() => handleZoom('out')} className="control-btn">Zoom -</button>
                                <button onClick={() => handleZoom('fit')} className="control-btn">Fit All</button>
                            </div>

                            <div ref={chartContainerRef} id="chart-container"></div>
                        </div>
                    </main>

                    <aside className="card p-5">
                        <h3 className="hebrew font-bold mb-4 border-b border-white/5 pb-2 uppercase text-xs tracking-widest text-slate-400">לוח בקרה</h3>
                        
                        <div className="space-y-4">
                            <div className="bg-slate-950 p-4 rounded-xl border border-white/5">
                                <div className="hebrew text-[10px] text-slate-500 mb-2">סטטוס אלגוריתם</div>
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                                    <span className="mono text-xs font-bold text-emerald-400 uppercase tracking-tighter">Scanning Support Levels</span>
                                </div>
                            </div>

                            <button className="w-full bg-blue-600 py-4 rounded-xl font-bold uppercase text-xs shadow-lg shadow-blue-900/20 hover:scale-[1.02] transition-transform">
                                Execute AI Strategy
                            </button>
                        </div>
                        
                        <div className="mt-8 bg-blue-500/5 p-4 rounded-xl border-r-4 border-blue-500 text-right">
                            <h4 className="hebrew text-[10px] text-blue-400 font-bold mb-2">סיכום טכני</h4>
                            <p className="hebrew text-xs leading-relaxed text-slate-300 italic">
                                שים לב לחיצים בגרף. הצבע הירוק מסמן נקודות כניסה מומלצות לפי מודל ה-RSI והמומנטום.
                            </p>
                        </div>
                    </aside>

                    <footer className="col-span-3 flex items-center justify-between px-4 text-[9px] text-slate-600 font-bold uppercase tracking-widest border-t border-white/5">
                        <span>Terminal Engine v5.1</span>
                        <span className="hebrew opacity-50">קוואנטה פרו • ניתוח היסטורי מורחב</span>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
